<!doctype html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<link rel="stylesheet" href="css/bootstrap.min.css">
	<title>🚀 - to the moon!</title>
</head>

<body class="d-block p-3">
	<ul class="nav nav-pills nav-fill">
		<li class="nav-item">
			<a class="nav-link" id="headerEncrypt" href="encrypt.html">Encrypt 📤</a>
		</li>
		<li class="nav-item">
			<a class="nav-link active bg-dark" id="headerDecrypt" href="decrypt.html">Decrypt 📥</a>
		</li>
	</ul>
	<hr>
	<form class="form">
		Emoji 🌈 ➡️ 📄 Text
		<hr>
		<div class="input-group">
			<div class="input-group-prepend">
				<span class="input-group-text">✉️</span>
			</div>
			<textarea class="form-control" placeholder="Paste message" aria-label="Emoji" id="inputText"
				rows="5"></textarea>
		</div>
		<br>
		<label for="emcode">
			<div class="text-center" id="decryptExplanation">Decrypt messages with an optional password</div>
		</label>
		<hr>
		<div class="mb-2" id="readKey">
			Read key from your browser
		</div>
		<div class="row">
			<div class="col">
				<div class="form-group">
					<select class="form-control" id="keySlot">
					  <option value="1">Slot 1️⃣</option>
					  <option value="2">Slot 2️⃣</option>
					  <option value="3">Slot 3️⃣</option>
					  <option value="4">Slot 4️⃣</option>
					  <option value="5">Slot 5️⃣</option>
					</select>
				  </div>
			</div>
			<div class="col">
				<button id="btnLoad" type="button" class="btn btn-primary bg-dark btn-block mb-2">📲 Load</button>
			</div>
		</div>
		<hr>
		<div class="input-group mb-3">
			<div class="input-group-prepend">
				<span class="input-group-text" id="emcode">🔑</span>
			</div>
			<input type="text" placeholder="(optional)" class="form-control" id="inputKey" aria-describedby="emcode">
		</div>
		<button id="btnDecode" type="button" class="btn btn-primary bg-dark btn-block mb-2">🔀 Decrypt</button>
	</form>
	<hr>
	<div class="input-group mb-3">
		<textarea class="form-control" aria-label="Emoji" id="messageOut" rows="10" readonly>Your message</textarea>
	</div>
	<hr>
	<p class="text-center">
		<b id="footerHigh">Secure on device text encryption!</b>
	</p>
	<div class="text-center">
		<a href="https://github.com/mqxym/EmojiCrypt" id="footerSource">Sourcecode (Github)</a>
	</div>





	<!-- Optional JavaScript -->
	<!-- jQuery first, then Popper.js, then Bootstrap JS -->
	<script src="js/jquery.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<script src="js/lib.js"></script>
	<script src="js/emo.js"></script>
	<script src="js/crypto.js"></script>
	<script src="js/lang.js"></script>
	
	<script>
		const lang = 0;

		function setLanguage () {
			$("#footerHigh").html(getFooterHigh(lang));
			$("#footerSource").html(getFooterSource(lang));
			$("#headerEncrypt").html(getHeaderEncrypt(lang));
			$("#headerDecrypt").html(getHeaderDecrypt(lang));

			
			$("#decryptExplanation").html(getDecryptExplanation(lang));
			$("#btnDecode").html(getBtnDecode(lang));
			$("#readKey").html(getReadKey(lang));
			$("btnLoad").html(getBtnLoad(lang));
			
		}

		$(document).ready(function () {

			setLanguage();

			$("#btnDecode").click(async function () {
				
				$(this).html(getBtnDecodeWorking(lang));
				
				console.log("Started Calculating Password Hash.")
				
				await new Promise(r => setTimeout(r, 15));
				
				let message = $("#inputText").val();
				let key = getPassword($("#inputKey").val());
				let mode = "emoji";
				
				decrypted = decrypt(message,key,mode);

				if (!decrypted) {
					$(this).html(getBtnDecodeFailed(lang));
				} else {
					$(this).html(getBtnDecodeSuccess(lang));
				}

				$("#messageOut").val(decrypted);
			});
			$("#btnLoad").click(async function () {
				let slot = $("#keySlot").val();
				console.log(slot);
				$(this).html(getLoadKey(lang));
				$(this).removeClass("bg-dark");
				$(this).addClass("bg-success");

				key = localStorage.getItem("key" + slot);
				//Use cookies
				//let key = getCookie("key"+slot);

				$("#inputKey").val(key);
				
				await new Promise(r => setTimeout(r, 1000));
				$(this).removeClass("bg-success");
				$(this).addClass("bg-dark");
				$(this).html(getBtnLoad(lang));
			});
		});
	</script>
</body>

</html>