<!doctype html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<link rel="stylesheet" href="css/bootstrap.min.css">
	<title>🚀 - to the moon!</title>

	<script src="js/jquery.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<script src="js/bootstrap.bundle.js"></script>
	<script src="js/crypto.js"></script>
</head>

<body class="d-block p-3">
	<ul class="nav nav-pills nav-fill">
		<li class="nav-item">
			<a class="nav-link active bg-dark" id="headerEncrypt" href="encrypt.html">Encrypt 📤</a>
		</li>
		<li class="nav-item">
			<a class="nav-link" href="decrypt.html" id="headerDecrypt">Decrypt 📥</a>
		</li>
	</ul>
	<hr>
	<form class="form">
		Text 📄 ➡️ 🌈 Emoji
		<hr>
		<div class="input-group mb-3">
			<div class="input-group-prepend">
				<span class="input-group-text">✉️</span>
			</div>
			<textarea class="form-control" placeholder="Message" aria-label="Emoji" id="inputText" rows="5"></textarea>
		</div>
		<label for="emcode">
			<div class="text-center" id="encryptExplanation">Encrypt messages with an optional password. Use the generate button when you need a good one.</div>
		</label>
		<div class="input-group mb-3">
			<div class="input-group-prepend">
				<span class="input-group-text" id="emcode">🔑</span>
			</div>
			<input type="text" placeholder="(optional)" class="form-control" id="inputKey" aria-describedby="emcode">
			<div class="input-group-append">
				<button id="btnKeyGenerate" type="button" class="btn btn-primary btn-block bg-dark">Generate</button>
			</div>
			<div class="input-group-append">
				<button id="copyKey" type="button" class="btn btn-primary bg-dark btn-block">Copy</button>
			</div>
		</div>
		<hr>
		<div id="saveKey" class="mb-2">
			Load or save keys 
		</div>
		<div class="row">
			<div class="col">
				<div class="form-group">
					<select class="form-control" id="keySlot">
					  <option value="1">Slot 1️⃣</option>
					  <option value="2">Slot 2️⃣</option>
					  <option value="3">Slot 3️⃣</option>
					  <option value="4">Slot 4️⃣</option>
					  <option value="5">Slot 5️⃣</option>
					</select>
				  </div>
			</div>
			<div class="col">
				<button id="btnLoad" type="button" class="btn btn-primary bg-dark btn-block mb-2">📲 Load</button>				
				<button id="btnSave" type="button" class="btn btn-primary bg-dark btn-block mb-2">💾 Save</button>
			</div>
		</div>
		<hr>
		<button id="btnEncode" type="button" class="btn btn-primary bg-dark btn-block mb-2">🔀 Encrypt</button>
	</form>
	<hr>
	<div class="input-group mb-3">
		<textarea class="form-control" aria-label="Emoji" id="out" rows="10" readonly>Copy from here</textarea>
		<div class="input-group-append">
			<button id="copyMessage" type="button" class="btn btn-primary btn-block bg-dark">Copy <br>to clipboard</button>
		</div>
	</div>
	<hr>
	<p class="text-center">
		<b id="footerHigh">Secure on device text encryption!</b>
	</p>
	<div class="text-center">
		<a href="https://github.com/mqxym/EmojiCrypt" id="footerSource">Sourcecode (Github)</a>
	</div>


	<!-- 
		Todo:
		- copy button for URL
		- add colors for status message
		- save password as a cookie
		- save language as cookie
		- languages (ger, span, port, rus, japan etc)
	-->

	<script src="js/lib.js"></script>
	<script src="js/emo.js"></script>
	<script src="js/lang.js"></script>

	<script>
		const lang = 0;

		let passHash = "";

		function setLanguage () {
			$("#footerHigh").html(getFooterHigh(lang));
			$("#footerSource").html(getFooterSource(lang));
			$("#headerEncrypt").html(getHeaderEncrypt(lang));
			$("#headerDecrypt").html(getHeaderDecrypt(lang));

			$("#encryptExplanation").html(getEncryptExplanation(lang));
			$("#btnEncode").html(getBtnEncode(lang));
			$("#btnKeyGenerate").html(getBtnKeyGenerate(lang));
			$("#copyKey").html(getCopyKey(lang));
			$("#copyMessage").html(getCopyMessage(lang));
			$("#out").html(getOut(lang));
			$("#saveKey").html(getSaveKey(lang));
			$("btnLoad").html(getBtnLoad(lang));
			$("btnSave").html(getBtnSave(lang));
			
		}

		$(document).ready(function () {

			setLanguage();

			$("#btnEncode").click(async function () {
				$(this).html(getBtnEncodeWorking(lang));
				console.log("Started Calculating Password Hash.")
				await new Promise(r => setTimeout(r, 15));

				let message = $("#inputText").val();
				let key = getPassword($("#inputKey").val());
				let mode = "emoji";

				let testHex = "";
				let emojiString = encrypt(message,key, mode);

				if (!emojiString) {
					$(this).html(getBtnEncodeFailed(lang))
				} else {
					$("#out").val(emojiString);
					$(this).html(getBtnEncodeFinished(lang));
				}
				
			});

			$("#btnKeyGenerate").click(function () {
				$("#inputKey").val(generateRandomEmo());
			});

			$("#copyKey").click(function () {
				let copyText = document.getElementById("inputKey");
				copyText.select();
				copyText.setSelectionRange(0, 99999);
				document.execCommand("copy");
			});

			$("#copyMessage").click(function () {
				let copyText = document.getElementById("out");
				copyText.select();
				copyText.setSelectionRange(0, 99999);
				document.execCommand("copy");
			});

			$("#btnLoad").click(async function () {
				let slot = $("#keySlot").val();
				console.log(slot);
				$(this).html(getLoadKey(lang));
				$(this).removeClass("bg-dark");
				$(this).addClass("bg-success");

				let key = getCookie("key"+slot);
				$("#inputKey").val(key);
				
				await new Promise(r => setTimeout(r, 1000));
				$(this).removeClass("bg-success");
				$(this).addClass("bg-dark");
				$(this).html(getBtnLoad(lang));
			});

			$("#btnSave").click(async function () {
				let slot = $("#keySlot").val();
				console.log(slot);
				$(this).html(getSaved(lang));
				$(this).removeClass("bg-dark");
				$(this).addClass("bg-success");

				setCookie("key"+slot,$("#inputKey").val(),777);

				await new Promise(r => setTimeout(r, 1000));
				$(this).removeClass("bg-success");
				$(this).addClass("bg-dark");
				$(this).html(getBtnSave(lang));
			});

		});


	
		function slotSaveButton (id) {
			if (id == 1) {
				$("#btnSaveKey2").removeClass("bg-success");
				$("#btnSaveKey3").removeClass("bg-success");
				$("#btnSaveKey2").addClass("bg-dark");
				$("#btnSaveKey3").addClass("bg-dark");
			} else if (id == 2) {
				$("#btnSaveKey1").removeClass("bg-success");
				$("#btnSaveKey3").removeClass("bg-success");
				$("#btnSaveKey1").addClass("bg-dark");
				$("#btnSaveKey3").addClass("bg-dark");
			} else if (id == 3) {
				$("#btnSaveKey1").removeClass("bg-success");
				$("#btnSaveKey2").removeClass("bg-success");
				$("#btnSaveKey1").addClass("bg-dark");
				$("#btnSaveKey2").addClass("bg-dark");			
			}

			let button = $("#btnSaveKey"+id);
			button.html(getSaved(lang));
			button.removeClass("bg-dark");
			button.addClass("bg-success");
			
		}

		function slotReadButton (id) {
			
			let button = $("#btnReadKey"+id);

			if (id == 1) {
				$("#btnReadKey2").removeClass("bg-success");
				$("#btnReadKey3").removeClass("bg-success");
				$("#btnReadKey2").addClass("bg-dark");
				$("#btnReadKey3").addClass("bg-dark");
			} else if (id == 2) {
				$("#btnReadKey1").removeClass("bg-success");
				$("#btnReadKey3").removeClass("bg-success");
				$("#btnReadKey1").addClass("bg-dark");
				$("#btnReadKey3").addClass("bg-dark");
			} else if (id == 3) {
				$("#btnReadKey1").removeClass("bg-success");
				$("#btnReadKey2").removeClass("bg-success");
				$("#btnReadKey1").addClass("bg-dark");
				$("#btnReadKey2").addClass("bg-dark");			
			}
			button.html(getLoadKey(lang));
			button.removeClass("bg-dark");
			button.addClass("bg-success");
			let key = getCookie("key"+id);
			

		}
	</script>
</body>

</html>